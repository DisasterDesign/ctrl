"use client";

import { useEffect, useRef } from "react";

// ═══════════════════════════════════════════════════════════
// 1:1 from Figma export: public/Group 46.svg
// All 156 line elements preserved in original order.
// viewBox: 0 0 324 792 (matches Figma frame)
// ═══════════════════════════════════════════════════════════

const LINES: [number, number, number, number][] = [
  [183,693,183,791],[1,643,1,741],
  [183,693,183,791],[1,643,1,741],
  [183,593,183,691],[1,543,1,641],
  [183,593,183,691],[1,543,1,641],
  [183,493,183,591],[1,443,1,541],
  [183,493,183,591],[1,443,1,541],
  [183,393,183,491],[1,343,1,441],
  [183,393,183,491],[1,343,1,441],
  [183,293,183,391],[1,243,1,341],
  [183,293,183,391],[1,243,1,341],
  [183,193,183,291],[1,143,1,241],
  [183,193,183,291],[1,143,1,241],
  [183,93,183,191],[1,43,1,141],
  [183,93,183,191],[1,43,1,141],
  [281,693,281,791],[99,643,99,741],
  [281,693,281,791],[99,643,99,741],
  [323,652,323,750],[141,602,141,700],
  [323,652,323,750],[141,602,141,700],
  [281,593,281,691],[99,543,99,641],
  [281,593,281,691],[99,543,99,641],
  [323,552,323,650],[141,502,141,600],
  [323,552,323,650],[141,502,141,600],
  [281,493,281,591],[99,443,99,541],
  [281,493,281,591],[99,443,99,541],
  [323,452,323,550],[141,402,141,500],
  [323,452,323,550],[141,402,141,500],
  [281,393,281,491],[99,343,99,441],
  [281,393,281,491],[99,343,99,441],
  [323,352,323,450],[141,302,141,400],
  [323,352,323,450],[141,302,141,400],
  [281,293,281,391],[99,243,99,341],
  [281,293,281,391],[99,243,99,341],
  [323,252,323,350],[141,202,141,300],
  [323,252,323,350],[141,202,141,300],
  [281,193,281,291],[99,143,99,241],
  [281,193,281,291],[99,143,99,241],
  [323,152,323,250],[141,102,141,200],
  [323,152,323,250],[141,102,141,200],
  [281,93,281,191],[99,43,99,141],
  [281,93,281,191],[99,43,99,141],
  [323,52,323,150],[141,2,141,100],
  [323,52,323,150],[141,2,141,100],
  [281,791,183,791],[99,741,1,741],
  [281,791,183,791],[99,741,1,741],
  [281,693,183,693],[99,643,1,643],
  [281,693,183,693],[99,643,1,643],
  [281,593,183,593],[99,543,1,543],
  [281,593,183,593],[99,543,1,543],
  [281,493,183,493],[99,443,1,443],
  [281,493,183,493],[99,443,1,443],
  [281,393,183,393],[99,343,1,343],
  [281,393,183,393],[99,343,1,343],
  [281,293,183,293],[99,243,1,243],
  [281,293,183,293],[99,243,1,243],
  [281,193,183,193],[99,143,1,143],
  [281,193,183,193],[99,143,1,143],
  [281,93,183,93],[99,43,1,43],
  [281,93,183,93],[99,43,1,43],
  [323,51,225,51],[141,1,43,1],
  [322.922,51.414,281.414,91.925],[140.922,1.414,99.414,41.925],
  [322.922,51.414,281.414,91.925],[140.922,1.414,99.414,41.925],
  [322.922,151.414,281.414,191.925],[140.922,101.414,99.414,141.925],
  [322.922,151.414,281.414,191.925],[140.922,101.414,99.414,141.925],
  [322.922,251.414,281.414,291.925],[140.922,201.414,99.414,241.925],
  [322.922,251.414,281.414,291.925],[140.922,201.414,99.414,241.925],
  [322.922,351.414,281.414,391.925],[140.922,301.414,99.414,341.925],
  [322.922,351.414,281.414,391.925],[140.922,301.414,99.414,341.925],
  [322.922,451.414,281.414,491.925],[140.922,401.414,99.414,441.925],
  [322.922,451.414,281.414,491.925],[140.922,401.414,99.414,441.925],
  [322.922,551.414,281.414,591.925],[140.922,501.414,99.414,541.925],
  [322.922,551.414,281.414,591.925],[140.922,501.414,99.414,541.925],
  [322.922,651.414,281.414,691.925],[140.922,601.414,99.414,641.925],
  [322.922,651.414,281.414,691.925],[140.922,601.414,99.414,641.925],
  [322.922,750.414,281.414,790.925],[140.922,700.414,99.414,740.925],
  [322.922,750.414,281.414,790.925],[140.922,700.414,99.414,740.925],
  [224.922,51.414,183.414,91.925],[42.921,1.414,1.414,41.925],
  [224.922,51.414,183.414,91.925],[42.921,1.414,1.414,41.925],
];

const C = {
  blue: "#3B82A0",
  grayBlue: "#94A3B8",
  grayVLight: "#E2E8F0",
};

function colorFor(midY: number): string {
  if (midY > 530) return C.grayVLight;
  if (midY > 264) return C.grayBlue;
  return C.blue;
}

function opacityFor(midY: number): number {
  if (midY > 530) return 0.5;
  if (midY > 264) return 0.7;
  return 1;
}

function scatter(idx: number) {
  const angle = (idx + 1) * 2.39996;
  const r = 50 + ((idx + 1) % 5) * 12;
  return {
    dx: Math.round(Math.cos(angle) * r),
    dy: Math.round(Math.sin(angle) * r),
    rot: Math.round(Math.sin(angle * 1.7) * 15),
  };
}

export default function HeroAnimation() {
  const svgRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    const svg = svgRef.current;
    if (!svg) return;

    const observer = new IntersectionObserver(
      ([entry]) => {
        const state = entry.isIntersecting ? "running" : "paused";
        svg.querySelectorAll(".hero-shape").forEach((el) => {
          (el as SVGElement).style.animationPlayState = state;
        });
      },
      { threshold: 0.1 }
    );
    observer.observe(svg);

    return () => observer.disconnect();
  }, []);

  return (
    <svg
      ref={svgRef}
      viewBox="0 0 324 792"
      className="hero-anim"
      fill="none"
      aria-hidden="true"
    >
      {LINES.map(([x1, y1, x2, y2], i) => {
        const cx = (x1 + x2) / 2;
        const cy = (y1 + y2) / 2;
        const s = scatter(i);
        return (
          <line
            key={i}
            className="hero-shape"
            style={
              {
                "--dx": `${s.dx}px`,
                "--dy": `${s.dy}px`,
                "--rot": `${s.rot}deg`,
                "--delay": `${(i * 0.025).toFixed(3)}s`,
                transformOrigin: `${cx}px ${cy}px`,
              } as React.CSSProperties
            }
            x1={x1}
            y1={y1}
            x2={x2}
            y2={y2}
            stroke={colorFor(cy)}
            strokeWidth={2}
            strokeLinecap="round"
            opacity={opacityFor(cy)}
          />
        );
      })}
    </svg>
  );
}
